# asset_diagnostic/diagnostics/__init__.py
# Diagnostic registry - import and register all diagnostics here

from typing import Dict, List, Optional, Type

from .base import BaseDiagnostic, CompositeDiagnostic
from .level import LevelDiagnostic

# Import future diagnostics here:
# from .blueprint import BlueprintDiagnostic
# from .material import MaterialDiagnostic
# from .static_mesh import StaticMeshDiagnostic

from ..core import AssetType


# Registry of all available diagnostics
_DIAGNOSTICS: List[BaseDiagnostic] = []


def register_diagnostic(diagnostic: BaseDiagnostic):
    """Register a diagnostic in the global registry."""
    _DIAGNOSTICS.append(diagnostic)


def get_diagnostics_for_type(asset_type: AssetType) -> List[BaseDiagnostic]:
    """Get all diagnostics that can handle the given asset type."""
    return [d for d in _DIAGNOSTICS if d.can_handle(asset_type)]


def get_diagnostic_for_type(asset_type: AssetType) -> Optional[BaseDiagnostic]:
    """
    Get a single diagnostic for the given asset type.
    If multiple diagnostics exist, returns a CompositeDiagnostic.
    """
    diagnostics = get_diagnostics_for_type(asset_type)

    if not diagnostics:
        return None
    elif len(diagnostics) == 1:
        return diagnostics[0]
    else:
        composite = CompositeDiagnostic(diagnostics)
        return composite


def get_all_diagnostics() -> List[BaseDiagnostic]:
    """Get all registered diagnostics."""
    return _DIAGNOSTICS.copy()


def get_supported_types() -> List[AssetType]:
    """Get all asset types that have at least one diagnostic."""
    types = set()
    for diag in _DIAGNOSTICS:
        types.update(diag.supported_types)
    return list(types)


# Register default diagnostics
register_diagnostic(LevelDiagnostic())

# Future: register additional diagnostics
# register_diagnostic(BlueprintDiagnostic())
# register_diagnostic(MaterialDiagnostic())
# register_diagnostic(StaticMeshDiagnostic())


__all__ = [
    "BaseDiagnostic",
    "CompositeDiagnostic",
    "LevelDiagnostic",
    "register_diagnostic",
    "get_diagnostics_for_type",
    "get_diagnostic_for_type",
    "get_all_diagnostics",
    "get_supported_types",
]
